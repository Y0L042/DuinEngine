<!-- HTML header for doxygen 1.11.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Duin: Duin Rendering Pipeline</title>
<!--BEGIN PROJECT_ICON-->
<link rel="icon" href="$projecticon" type="image/x-icon" />
<!--END PROJECT_ICON-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--BEGIN COPY_CLIPBOARD-->
<script type="text/javascript" src="clipboard.js"></script>
<!--END COPY_CLIPBOARD-->
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<html>
    <head>
        <!-- ... other metadata & script includes ... -->
        <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
        <script type="text/javascript">
            DoxygenAwesomeParagraphLink.init()
        </script>
    </head>
    <body>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Duin<span id="projectnumber">&#160;0.0.1</span>
   </div>
   <div id="projectbrief">Game Engine</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_docs_2RenderingPipeline.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Duin Rendering Pipeline</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1"></a> </p>
<h1><a class="anchor" id="autotoc_md2"></a>
Overview</h1>
<p>Duin uses <b>BGFX</b> as its cross-platform rendering backend, supporting D3D11/12, OpenGL, Vulkan, and Metal. The rendering system provides:</p>
<ul>
<li>3D rendering with camera-based view/projection matrices</li>
<li>Render-to-texture for offscreen rendering (viewports, post-processing)</li>
<li>Debug drawing for development visualization</li>
<li>ImGui integration for UI rendering</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Architecture</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Core Components</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Component   </th><th class="markdownTableHeadNone">File   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Renderer</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="Renderer_8h.html" title="Core rendering system and utilities.">Renderer.h</a>/cpp</code>   </td><td class="markdownTableBodyNone">Main rendering interface    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Camera</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="Camera_8h.html" title="3D camera for rendering.">Camera.h</a>/cpp</code>   </td><td class="markdownTableBodyNone">3D camera with view/projection    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>RenderTexture</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="Renderer_8h.html" title="Core rendering system and utilities.">Renderer.h</a></code>   </td><td class="markdownTableBodyNone">Offscreen render target    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>RenderState</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="Renderer_8h.html" title="Core rendering system and utilities.">Renderer.h</a></code>   </td><td class="markdownTableBodyNone">Current rendering configuration    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>RenderGeometry</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="RenderGeometry_8h_source.html">RenderGeometry.h</a></code>   </td><td class="markdownTableBodyNone">Primitive geometry definitions    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ShaderProgram</code>   </td><td class="markdownTableBodyNone"><code><a class="el" href="Renderer_8h.html" title="Core rendering system and utilities.">Renderer.h</a></code>   </td><td class="markdownTableBodyNone">Compiled shader programs   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md5"></a>
BGFX View System</h2>
<p>BGFX uses a <b>multi-view</b> architecture where each view represents a render pass with its own:</p><ul>
<li>Framebuffer target (backbuffer or texture)</li>
<li>Viewport dimensions</li>
<li>Clear settings</li>
<li>Transform matrices</li>
</ul>
<p><b>View ID Convention:</b></p><ul>
<li><b>View 0</b>: Main display (backbuffer)</li>
<li><b>View 1+</b>: Render textures (offscreen targets)</li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Render State Machine</h1>
<p>The renderer maintains a global <code>RenderState</code> that tracks the current rendering context:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>RenderState {</div>
<div class="line">    RenderTexture *target = <span class="keyword">nullptr</span>;  <span class="comment">// Active render target (nullptr = backbuffer)</span></div>
<div class="line">    Camera *camera = <span class="keyword">nullptr</span>;         <span class="comment">// Active camera</span></div>
<div class="line">    <span class="keywordtype">bool</span> in3DMode = <span class="keyword">false</span>;            <span class="comment">// True between BeginDraw3D/EndDraw3D</span></div>
<div class="line">    <span class="keywordtype">bool</span> inTextureMode = <span class="keyword">false</span>;       <span class="comment">// True between BeginTextureMode/EndTextureMode</span></div>
<div class="line">    DebugDrawState debugDrawState;</div>
<div class="line">    Matrix viewMatrix;</div>
<div class="line">    Matrix projectionMatrix;</div>
<div class="line">    <a class="code hl_struct" href="structUUID.html">UUID</a> stateUUID;</div>
<div class="line">    <span class="keywordtype">size_t</span> viewID = 0;                <span class="comment">// Current BGFX view ID</span></div>
<div class="line">};</div>
<div class="ttc" id="astructUUID_html"><div class="ttname"><a href="structUUID.html">UUID</a></div><div class="ttdef"><b>Definition</b> <a href="uuid_8h_source.html#l00012">uuid.h:13</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
State Stack</h2>
<p>The renderer uses a stack-based state machine to support nested rendering modes:</p>
<div class="fragment"><div class="line">globalRenderStateStack: [State0, State1, State2, ...]</div>
<div class="line">                                               ↑</div>
<div class="line">                              globalRenderState (current)</div>
</div><!-- fragment --><p>When entering a new mode (e.g., texture mode), the current state is pushed onto the stack. When exiting, the previous state is popped and restored.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Rendering Modes</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
1. Main Display Rendering (View 0)</h2>
<p>Standard 3D rendering to the screen backbuffer.</p>
<div class="fragment"><div class="line"><span class="comment">// Begin 3D rendering with camera</span></div>
<div class="line">duin::BeginDraw3D(camera);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Draw calls go to View 0 (main display)</span></div>
<div class="line">duin::DrawBox(position, rotation, size);</div>
<div class="line">duin::DrawSphere(position, rotation, size);</div>
<div class="line">duin::DrawGrid(100.0f);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// End 3D rendering</span></div>
<div class="line">duin::EndDraw3D();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Present frame</span></div>
<div class="line">duin::ExecuteRenderPipeline();</div>
</div><!-- fragment --><p><b>What happens in <code>BeginDraw3D</code>:</b></p><ol type="1">
<li>Clears the render state stack</li>
<li>Sets view/projection matrices from camera</li>
<li>Configures BGFX view 0 (transform, viewport, clear)</li>
<li>Sets <code>in3DMode = true</code>, <code>camera = &amp;camera</code></li>
<li>Pushes state to stack</li>
<li>Begins BGFX encoder and debug draw</li>
</ol>
<h2><a class="anchor" id="autotoc_md10"></a>
2. Render-to-Texture Mode (View 1+)</h2>
<p>Renders to an offscreen texture instead of the screen.</p>
<div class="fragment"><div class="line"><span class="comment">// Create render texture with unique view ID</span></div>
<div class="line"><a class="code hl_struct" href="structduin_1_1RenderTexture.html">duin::RenderTexture</a> texture(width, height, uuid);</div>
<div class="line">texture.viewID = 1;  <span class="comment">// IMPORTANT: Must be &gt; 0 to avoid conflict with main display</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Begin texture mode</span></div>
<div class="line">duin::BeginTextureMode(texture);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// All draw calls now go to View 1 (texture)</span></div>
<div class="line">duin::DrawGrid(100.0f);</div>
<div class="line">duin::DrawDebugSphere({0, 0, 0}, 5.0f);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// End texture mode</span></div>
<div class="line">duin::EndTextureMode();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Display texture in ImGui</span></div>
<div class="line">duin::DrawIMGUITexture(texture, {width, height});</div>
<div class="ttc" id="astructduin_1_1RenderTexture_html"><div class="ttname"><a href="structduin_1_1RenderTexture.html">duin::RenderTexture</a></div><div class="ttdoc">Offscreen render target.</div><div class="ttdef"><b>Definition</b> <a href="Renderer_8h_source.html#l00085">Renderer.h:86</a></div></div>
</div><!-- fragment --><p><b>What happens in <code>BeginTextureMode</code>:</b></p><ol type="1">
<li>Pushes current state to stack</li>
<li>Sets <code>inTextureMode = true</code>, <code>target = &amp;texture</code></li>
<li>Sets <code>viewID = texture.viewID</code></li>
<li>Binds BGFX framebuffer to the texture's view ID</li>
<li>Sets viewport and clear for the texture's view</li>
</ol>
<p><b>What happens in <code>EndTextureMode</code>:</b></p><ol type="1">
<li>Pops previous state from stack</li>
<li>Restores <code>viewID</code>, <code>target</code>, mode flags</li>
</ol>
<h2><a class="anchor" id="autotoc_md11"></a>
3. Nested Texture Modes</h2>
<p>Texture modes can be nested (e.g., render texture A, then within that render to texture B):</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structduin_1_1RenderTexture.html">duin::RenderTexture</a> texA, texB;</div>
<div class="line">texA.<a class="code hl_variable" href="structduin_1_1RenderTexture.html#a79b17e2faca645f6f9d91e731de5caca">viewID</a> = 1;</div>
<div class="line">texB.<a class="code hl_variable" href="structduin_1_1RenderTexture.html#a79b17e2faca645f6f9d91e731de5caca">viewID</a> = 2;</div>
<div class="line"> </div>
<div class="line">duin::BeginTextureMode(texA);  <span class="comment">// viewID = 1</span></div>
<div class="line">    <span class="comment">// draws go to View 1</span></div>
<div class="line"> </div>
<div class="line">    duin::BeginTextureMode(texB);  <span class="comment">// viewID = 2</span></div>
<div class="line">        <span class="comment">// draws go to View 2</span></div>
<div class="line">    duin::EndTextureMode();  <span class="comment">// viewID restored to 1</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// draws go to View 1 again</span></div>
<div class="line">duin::EndTextureMode();  <span class="comment">// viewID restored to 0</span></div>
<div class="ttc" id="astructduin_1_1RenderTexture_html_a79b17e2faca645f6f9d91e731de5caca"><div class="ttname"><a href="structduin_1_1RenderTexture.html#a79b17e2faca645f6f9d91e731de5caca">duin::RenderTexture::viewID</a></div><div class="ttdeci">bgfx::ViewId viewID</div><div class="ttdoc">BGFX view ID.</div><div class="ttdef"><b>Definition</b> <a href="Renderer_8h_source.html#l00089">Renderer.h:89</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md12"></a>
Draw Functions</h1>
<p>All draw functions submit to <code>globalRenderState.viewID</code>, ensuring they render to the correct target:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>DrawBox()</code>   </td><td class="markdownTableBodyNone">Draws a box primitive    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>DrawSphere()</code>   </td><td class="markdownTableBodyNone">Draws a sphere primitive    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>DrawSquare()</code>   </td><td class="markdownTableBodyNone">Draws a plane/square primitive    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>DrawPlane()</code>   </td><td class="markdownTableBodyNone">Draws a plane at origin    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>DrawGrid()</code>   </td><td class="markdownTableBodyNone">Draws a debug grid    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>DrawDebugSphere()</code>   </td><td class="markdownTableBodyNone">Draws a debug wireframe sphere   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md13"></a>
Internal Flow</h2>
<div class="fragment"><div class="line">DrawBox(pos, rot, size)</div>
<div class="line">    ↓</div>
<div class="line">QueueRender(RenderGeometryType::BOX, pos, rot, size)</div>
<div class="line">    ↓</div>
<div class="line">encoder-&gt;submit(globalRenderState.viewID, program)</div>
<div class="line">    ↓</div>
<div class="line">BGFX renders to the view&#39;s framebuffer</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md14"></a>
RenderTexture</h1>
<p>A <code>RenderTexture</code> is an offscreen render target backed by a BGFX texture and framebuffer:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>RenderTexture {</div>
<div class="line">    uint16_t width, height;              <span class="comment">// Texture dimensions</span></div>
<div class="line">    <a class="code hl_struct" href="structUUID.html">UUID</a> textureUUID;                    <span class="comment">// Unique identifier</span></div>
<div class="line">    bgfx::ViewId viewID = 0;             <span class="comment">// BGFX view ID for this texture</span></div>
<div class="line">    bgfx::TextureHandle texture;         <span class="comment">// BGFX texture handle</span></div>
<div class="line">    bgfx::FrameBufferHandle frameBuffer; <span class="comment">// BGFX framebuffer handle</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
Creating a RenderTexture</h2>
<div class="fragment"><div class="line"><span class="comment">// Create with dimensions and UUID</span></div>
<div class="line"><a class="code hl_struct" href="structduin_1_1RenderTexture.html">duin::RenderTexture</a> rt(800, 600, <a class="code hl_class" href="classduin_1_1UUID.html">duin::UUID</a>());</div>
<div class="line"> </div>
<div class="line"><span class="comment">// CRITICAL: Assign unique viewID &gt; 0</span></div>
<div class="line">rt.viewID = 1;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Verify validity before use</span></div>
<div class="line"><span class="keywordflow">if</span> (rt.IsValid()) {</div>
<div class="line">    <span class="comment">// Safe to render</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassduin_1_1UUID_html"><div class="ttname"><a href="classduin_1_1UUID.html">duin::UUID</a></div><div class="ttdoc">A 64-bit universally unique identifier.</div><div class="ttdef"><b>Definition</b> <a href="UUID_8h_source.html#l00058">UUID.h:59</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
ViewID Best Practices</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">ViewID   </th><th class="markdownTableHeadNone">Usage    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0   </td><td class="markdownTableBodyNone">Reserved for main display    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">1-255   </td><td class="markdownTableBodyNone">Available for render textures   </td></tr>
</table>
<p><b>Rules:</b></p><ol type="1">
<li>Each <code>RenderTexture</code> must have a unique <code>viewID</code></li>
<li>Never use <code>viewID = 0</code> for render textures (conflicts with main display)</li>
<li>Manage viewIDs to avoid collisions when using multiple textures</li>
</ol>
<h2><a class="anchor" id="autotoc_md17"></a>
Cleanup</h2>
<div class="fragment"><div class="line"><span class="comment">// Destroy when no longer needed</span></div>
<div class="line"><span class="keywordflow">if</span> (rt.IsValid()) {</div>
<div class="line">    rt.Destroy();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md18"></a>
Camera System</h1>
<p>The <code>Camera</code> struct defines 3D view parameters:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Camera {</div>
<div class="line">    <a class="code hl_struct" href="structUUID.html">UUID</a> uuid;</div>
<div class="line">    Vector3 position;    <span class="comment">// Camera position in world space</span></div>
<div class="line">    Vector3 target;      <span class="comment">// Point the camera looks at</span></div>
<div class="line">    Vector3 up;          <span class="comment">// Computed up vector (orthonormal)</span></div>
<div class="line">    <span class="keywordtype">float</span> fovy = 72.0f;  <span class="comment">// Vertical field of view in degrees</span></div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md19"></a>
Coordinate System</h2>
<p>Duin uses a <b>right-hand</b> coordinate system with <b>+Z toward the viewer</b> (same as Godot).</p>
<h2><a class="anchor" id="autotoc_md20"></a>
Camera Matrix Computation</h2>
<div class="fragment"><div class="line"><span class="comment">// View matrix: world → camera space</span></div>
<div class="line">Matrix view = GetCameraViewMatrix(&amp;camera);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Projection matrix: camera → clip space (perspective)</span></div>
<div class="line">Matrix proj = GetCameraProjectionMatrix(&amp;camera);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md21"></a>
Camera Movement</h2>
<div class="fragment"><div class="line">CameraMoveForward(&amp;camera, distance);  <span class="comment">// Move along forward axis</span></div>
<div class="line">CameraMoveUp(&amp;camera, distance);       <span class="comment">// Move along up axis</span></div>
<div class="line">CameraMoveRight(&amp;camera, distance);    <span class="comment">// Move along right axis</span></div>
<div class="line">CameraMoveToTarget(&amp;camera, delta);    <span class="comment">// Move toward/away from target</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md22"></a>
Camera Rotation</h2>
<div class="fragment"><div class="line">CameraYaw(&amp;camera, angle, rotateAroundTarget);   <span class="comment">// Rotate around vertical axis</span></div>
<div class="line">CameraPitch(&amp;camera, angle, lockView, rotateAroundTarget, rotateUp);  <span class="comment">// Rotate around horizontal axis</span></div>
<div class="line">CameraRoll(&amp;camera, angle);  <span class="comment">// Rotate around forward axis</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md23"></a>
Debug Drawing</h1>
<p>The debug draw system uses <code>bgfx-debugdraw</code> for immediate-mode debug visualization:</p>
<div class="fragment"><div class="line"><span class="comment">// Debug draw is automatically started in BeginDraw3D</span></div>
<div class="line">duin::DrawGrid(100.0f);           <span class="comment">// Grid on Y plane</span></div>
<div class="line">duin::DrawDebugSphere(pos, 5.0f); <span class="comment">// Wireframe sphere</span></div>
</div><!-- fragment --><p>Debug drawing respects the current <code>viewID</code>, so debug shapes render to the correct target (main display or texture).</p>
<h1><a class="anchor" id="autotoc_md24"></a>
Frame Lifecycle</h1>
<p>A typical frame follows this pattern:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Draw() {</div>
<div class="line">    <span class="comment">// 1. Render scene to texture (for editor viewport)</span></div>
<div class="line">    duin::BeginTextureMode(sceneTexture);</div>
<div class="line">        duin::ClearBackground(duin::GRAY, sceneTexture.viewID);</div>
<div class="line">        duin::DrawGrid(100.0f);</div>
<div class="line">        <span class="comment">// ... draw scene objects</span></div>
<div class="line">    duin::EndTextureMode();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// 2. Main 3D pass (optional, for game view)</span></div>
<div class="line">    duin::BeginDraw3D(mainCamera);</div>
<div class="line">        <span class="comment">// ... draw game objects</span></div>
<div class="line">    duin::EndDraw3D();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> DrawUI() {</div>
<div class="line">    <span class="comment">// 3. ImGui pass</span></div>
<div class="line">    ImGui::Begin(<span class="stringliteral">&quot;Viewport&quot;</span>);</div>
<div class="line">        duin::DrawIMGUITexture(sceneTexture, {800, 600});</div>
<div class="line">    ImGui::End();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> PostDraw() {</div>
<div class="line">    <span class="comment">// 4. Present frame</span></div>
<div class="line">    duin::ExecuteRenderPipeline();  <span class="comment">// Calls bgfx::frame()</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md25"></a>
Geometry System</h1>
<p>Primitive geometry is defined in <code><a class="el" href="RenderGeometry_8h_source.html">RenderGeometry.h</a></code>:</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>RenderGeometryType {</div>
<div class="line">    <span class="keyword">enum</span> Type {</div>
<div class="line">        BOX = 0,</div>
<div class="line">        SPHERE,</div>
<div class="line">        CAPSULE,</div>
<div class="line">        PLANE,</div>
<div class="line">        CONE,</div>
<div class="line">        CYLINDER,</div>
<div class="line">        DISK,</div>
<div class="line">        TRIANGLE,</div>
<div class="line">        TRIANGLEMESH,</div>
<div class="line">        NONE,</div>
<div class="line">        Count</div>
<div class="line">    };</div>
<div class="line">}</div>
</div><!-- fragment --><p>Geometry buffers are created at initialization and reused:</p>
<div class="fragment"><div class="line"><span class="comment">// Vertex format: Position (float3) + Color (uint32 ABGR)</span></div>
<div class="line"><span class="keyword">struct </span>PosColorVertex {</div>
<div class="line">    <span class="keywordtype">float</span> x, y, z;</div>
<div class="line">    uint32_t abgr;</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md26"></a>
Shader System</h1>
<p>Shaders are managed via <code>ShaderProgram</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>ShaderProgram {</div>
<div class="line">    <a class="code hl_struct" href="structUUID.html">UUID</a> uuid;</div>
<div class="line">    bgfx::ShaderHandle vsh;      <span class="comment">// Vertex shader</span></div>
<div class="line">    bgfx::ShaderHandle fsh;      <span class="comment">// Fragment shader</span></div>
<div class="line">    bgfx::ProgramHandle program; <span class="comment">// Combined program</span></div>
<div class="line">    uint8_t isValid = 0;</div>
<div class="line">};</div>
</div><!-- fragment --><p>Default shaders are loaded at initialization from precompiled <code>.bin</code> files.</p>
<h1><a class="anchor" id="autotoc_md27"></a>
Test Accessors</h1>
<p>For unit testing render state without GPU context:</p>
<div class="fragment"><div class="line"><span class="comment">// Get current state (copy)</span></div>
<div class="line">RenderState state = duin::GetCurrentRenderState();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get stack depth</span></div>
<div class="line"><span class="keywordtype">size_t</span> depth = duin::GetRenderStateStackDepth();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Reset state for testing</span></div>
<div class="line">duin::ResetRenderStateForTesting();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Simulate texture mode (no GPU calls)</span></div>
<div class="line">duin::BeginTextureModeForTesting(texture);</div>
<div class="line">duin::EndTextureModeForTesting();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Verify viewID usage</span></div>
<div class="line"><span class="keywordtype">size_t</span> expected = duin::GetExpectedDrawViewID();</div>
<div class="line"><span class="keywordtype">size_t</span> queueRender = duin::GetQueueRenderViewID();</div>
<div class="line"><span class="keywordtype">size_t</span> debugDraw = duin::GetDebugDrawViewID();</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md28"></a>
Common Issues</h1>
<h2><a class="anchor" id="autotoc_md29"></a>
Render-to-Texture Shows on Main Screen</h2>
<p><b>Cause:</b> <code>viewID</code> set to 0 (same as main display) or draw calls ignoring <code>globalRenderState.viewID</code>.</p>
<p><b>Solution:</b> Ensure <code>texture.viewID &gt; 0</code> and that all draw functions use <code>globalRenderState.viewID</code> for submissions.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Flickering After EndTextureMode</h2>
<p><b>Cause:</b> Framebuffer binding not properly restored.</p>
<p><b>Solution:</b> Use different viewIDs for each render target. View 0 should only be used for the main backbuffer.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Debug Draws Not Appearing in Texture</h2>
<p><b>Cause:</b> <code>BeginDebugDraw</code> using wrong viewID.</p>
<p><b>Solution:</b> Verify <code>BeginDebugDraw</code> uses <code>globalRenderState.viewID</code>.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
File Locations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">File   </th><th class="markdownTableHeadNone">Path    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Renderer   </td><td class="markdownTableBodyNone"><code><a class="el" href="Renderer_8h.html" title="Core rendering system and utilities.">Duin/src/Duin/Render/Renderer.h</a></code>, <code><a class="el" href="Renderer_8cpp_source.html">Renderer.cpp</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Camera   </td><td class="markdownTableBodyNone"><code><a class="el" href="Camera_8h.html" title="3D camera for rendering.">Duin/src/Duin/Render/Camera.h</a></code>, <code><a class="el" href="Camera_8cpp_source.html">Camera.cpp</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">RenderGeometry   </td><td class="markdownTableBodyNone"><code><a class="el" href="RenderGeometry_8h_source.html">Duin/src/Duin/Render/RenderGeometry.h</a></code>, <code><a class="el" href="RenderGeometry_8cpp_source.html">RenderGeometry.cpp</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Shader   </td><td class="markdownTableBodyNone"><code><a class="el" href="Shader_8h_source.html">Duin/src/Duin/Render/Shader.h</a></code>, <code><a class="el" href="Shader_8cpp_source.html">Shader.cpp</a></code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Color   </td><td class="markdownTableBodyNone"><code><a class="el" href="Color_8h.html" title="RGBA color representation.">Duin/src/Duin/Render/Color.h</a></code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Tests   </td><td class="markdownTableBodyNone"><code>DuinTests/src/Render/TestRenderer.cpp</code>   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
